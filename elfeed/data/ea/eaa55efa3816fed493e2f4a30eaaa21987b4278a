<p>We are pleased to announce the release of Ruby 2.7.0-preview1.</p>

<p>A preview version is released to gather feedback for the final release planned to release on December. It introduces a number of new features and performance improvements, most notably:</p>

<ul>
  <li>Compaction GC</li>
  <li>Pattern Matching</li>
  <li>REPL improvement</li>
</ul>

<h2>Compaction GC</h2>

<p>This release introduces Compaction GC which can defragment a fragmented memory space.</p>

<p>Some multithread Ruby programs may cause memory fragmentation, leading to high memory usage and degraded speed.</p>

<p>The <code>GC.compact</code> method is introduced for compacting the heap. This function compacts live objects in the heap so that fewer pages may be used, and the heap may be more CoW friendly. <a href="https://bugs.ruby-lang.org/issues/15626">#15626</a></p>

<h2>Pattern Matching [Experimental]</h2>

<p>Pattern matching, widely used feature in functional programming languages, is introduced as an experimental feature. <a href="https://bugs.ruby-lang.org/issues/14912">#14912</a>
It can traverse a given object and assign its value if it matches a pattern.</p>

<pre><code class="language-ruby">case JSON.parse('{...}', symbolize_names: true)
in {name: "Alice", children: [{name: "Bob", age: age}]}
  p age
  ...
end
</code></pre>

<p>For more details, please see <a href="https://speakerdeck.com/k_tsj/pattern-matching-new-feature-in-ruby-2-dot-7">Pattern matching - New feature in Ruby 2.7</a>.</p>

<h2>REPL improvement</h2>

<p><code>irb</code>, bundled interactive environment (REPL; Read-Eval-Print-Loop), now supports multi-line editing. Itâ€™s powered by <code>reline</code>, <code>readline</code> compatible pure Ruby implementation.
It also provides rdoc integration. In <code>irb</code> you can display the reference for a given class, module, or method.  <a href="https://bugs.ruby-lang.org/issues/14683">#14683</a>, <a href="https://bugs.ruby-lang.org/issues/14787">#14787</a>, <a href="https://bugs.ruby-lang.org/issues/14918">#14918</a>
Besides, source lines shown at <code>binding.irb</code> and inspect results for core-class objects are now colorized.</p>

<video autoplay="autoplay" controls="controls" muted="muted" width="576" height="259">
  <source src="https://cache.ruby-lang.org/pub/media/irb_improved_with_key_take2.mp4" type="video/mp4" />
</video>

<h2>Other Notable New Features</h2>

<ul>
  <li>
    <p>A method reference operator, <code>.:</code>, is introduced as an experimental feature.  <a href="https://bugs.ruby-lang.org/issues/12125">#12125</a>, <a href="https://bugs.ruby-lang.org/issues/13581">#13581</a></p>
  </li>
  <li>
    <p>Numbered parameter as the default block parameter is introduced as an experimental feature.  <a href="https://bugs.ruby-lang.org/issues/4475">#4475</a></p>
  </li>
  <li>
    <p>A beginless range is experimentally introduced.  It might not be as useful
as an endless range, but would be good for DSL purpose. <a href="https://bugs.ruby-lang.org/issues/14799">#14799</a></p>

    <pre><code>ary[..3]  # identical to ary[0..3]
rel.where(sales: ..100)
</code></pre>
  </li>
  <li>
    <p><code>Enumerable#tally</code> is added.  It counts the occurrence of each element.</p>

    <pre><code>["a", "b", "c", "b"].tally
#=&gt; {"a"=&gt;1, "b"=&gt;2, "c"=&gt;1}
</code></pre>
  </li>
</ul>

<h2>Performance improvements</h2>

<ul>
  <li>
    <p>JIT [Experimental]</p>

    <ul>
      <li>
        <p>JIT-ed code is recompiled to less-optimized code when an optimization assumption is invalidated.</p>
      </li>
      <li>
        <p>Method inlining is performed when a method is considered as pure. This optimization is still experimental and many methods are NOT considered as pure yet.</p>
      </li>
      <li>
        <p>Default value of <code>--jit-min-calls</code> is changed from 5 to 10,000</p>
      </li>
      <li>
        <p>Default value of <code>--jit-max-cache</code> is changed from 1,000 to 100</p>
      </li>
    </ul>
  </li>
</ul>

<h2>Other notable changes since 2.6</h2>

<ul>
  <li>
    <p><code>Proc.new</code> and <code>proc</code> with no block in a method called with a block is warned now.</p>
  </li>
  <li>
    <p><code>lambda</code> with no block in a method called with a block errs.</p>
  </li>
  <li>
    <p>Update Unicode version and Emoji version from 11.0.0 to 12.0.0.  <a href="https://bugs.ruby-lang.org/issues/15321">[Feature #15321]</a></p>
  </li>
  <li>
    <p>Update Unicode version to 12.1.0, adding support for U+32FF SQUARE ERA NAME REIWA.  <a href="https://bugs.ruby-lang.org/issues/15195">[Feature #15195]</a></p>
  </li>
  <li>
    <p><code>Date.jisx0301</code>, <code>Date#jisx0301</code>, and <code>Date.parse</code> provisionally support the new Japanese era as an informal extension, until the new JIS X 0301 is issued.  <a href="https://bugs.ruby-lang.org/issues/15742">[Feature #15742]</a></p>
  </li>
  <li>
    <p>Require compilers to support C99 <a href="https://bugs.ruby-lang.org/issues/15347">[Misc #15347]</a></p>
    <ul>
      <li>Details of our dialect: <a href="https://bugs.ruby-lang.org/projects/ruby-trunk/wiki/C99">https://bugs.ruby-lang.org/projects/ruby-trunk/wiki/C99</a></li>
    </ul>
  </li>
</ul>

<p>See <a href="https://github.com/ruby/ruby/blob/v2_7_0_preview1/NEWS">NEWS</a> or <a href="https://github.com/ruby/ruby/compare/v2_6_0...v2_7_0_preview1">commit logs</a> for more details.</p>

<p>With those changes, <a href="https://github.com/ruby/ruby/compare/v2_6_0...v2_7_0_preview1">1727 files changed, 76022 insertions(+), 60286 deletions(-)</a> since Ruby 2.6.0!</p>

<p>Enjoy programming with Ruby 2.7!</p>

<h2>Download</h2>

<ul>
  <li>
    <p><a href="https://cache.ruby-lang.org/pub/ruby/2.7/ruby-2.7.0-preview1.tar.gz">https://cache.ruby-lang.org/pub/ruby/2.7/ruby-2.7.0-preview1.tar.gz</a></p>

    <pre><code>SIZE:   16021286 bytes
SHA1:   2fbecf42b03a9d4391b81de42caec7fa497747cf
SHA256: c44500af4a4a0c78a0b4d891272523f28e21176cf9bc1cc108977c5f270eaec2
SHA512: f731bc9002edd3a61a4955e4cc46a75b5ab687a19c7964f02d3b5b07423d2360d25d7be5df340e884ca9945e3954e68e5eb11b209b65b3a687c71a1abc24b91f
</code></pre>
  </li>
  <li>
    <p><a href="https://cache.ruby-lang.org/pub/ruby/2.7/ruby-2.7.0-preview1.zip">https://cache.ruby-lang.org/pub/ruby/2.7/ruby-2.7.0-preview1.zip</a></p>

    <pre><code>SIZE:   20283343 bytes
SHA1:   7488346fa8e58203a38158752d03c8be6b1da65b
SHA256: fdf25573e72e1769b51b8d541d0e1a894a5394dbfdf1b08215aa093079cca64c
SHA512: b3b1f59dce94c242ef88a4e68381a4c3a6f90ba0af699083e5a1a00b0fb1dce580f057dad25571fe789ac9aa95aa6e9c071ebb330328dc822217ac9ea9fbeb3f
</code></pre>
  </li>
  <li>
    <p><a href="https://cache.ruby-lang.org/pub/ruby/2.7/ruby-2.7.0-preview1.tar.bz2">https://cache.ruby-lang.org/pub/ruby/2.7/ruby-2.7.0-preview1.tar.bz2</a></p>

    <pre><code>SIZE:   14038296 bytes
SHA1:   f7e70cbc2604c53a9e818a2fc59cd0e2d6c859fa
SHA256: d45b4a1712ec5c03a35e85e33bcb57c7426b856d35e4f04f7975ae3944d09952
SHA512: a36b241fc1eccba121bb7c2cc5675b11609e0153e25a3a8961b67270c05414b1aa669ce5d4a5ebe4c6b2328ea2b8f8635fbba046b70de103320b3fdcb3d51248
</code></pre>
  </li>
  <li>
    <p><a href="https://cache.ruby-lang.org/pub/ruby/2.7/ruby-2.7.0-preview1.tar.xz">https://cache.ruby-lang.org/pub/ruby/2.7/ruby-2.7.0-preview1.tar.xz</a></p>

    <pre><code>SIZE:   11442988 bytes
SHA1:   45e467debc194847a9e3afefb20b11e6dc28ea31
SHA256: 8c546df3345398b3edc9d0ab097846f033783d33762889fd0f3dc8bb465c3354
SHA512: d416e90bfa3e49cc0675c4c13243c8ec319b7a0836add1bd16bd7662d09eaf46656d26e772ef3b097e10779896e643edd8a6e4f885147e3235257736adfdf3b5
</code></pre>
  </li>
</ul>

<h2>What is Ruby</h2>

<p>Ruby was first developed by Matz (Yukihiro Matsumoto) in 1993, and is now developed as Open Source. It runs on multiple platforms and is used all over the world especially for web development.</p>

<p>Posted by naruse on 30 May 2019</p>