<p>An Amazon Machine Image (AMI) provides the information that you need to launch an instance (a virtual server) in your AWS environment. There are a number of AMIs on the <a href="https://aws.amazon.com/marketplace" rel="noopener noreferrer" target="_blank">AWS Marketplace</a> (such as Amazon Linux, Red Hat or Ubuntu) that you can use to launch an <a href="https://aws.amazon.com/ec2/" rel="noopener noreferrer" target="_blank">Amazon Elastic Compute Cloud</a> (Amazon EC2) instance. When you launch an instance from these AMIs, the resulting volumes are unencrypted. However, for regulatory purposes or internal compliance reasons, you might need to launch instances with encrypted root volumes. Previously, this required you to follow a <a href="https://aws.amazon.com/blogs/security/how-to-create-a-custom-ami-with-encrypted-amazon-ebs-snapshots-and-share-it-with-other-accounts-and-regions/" rel="noopener noreferrer" target="_blank">a multi-step process</a> in which you maintained a separate, encrypted copy of the AMI in your account in order to launch instances with encrypted volumes. Now, you no longer need to maintain multiple AMI copies for encryption. To launch an encrypted <a href="https://aws.amazon.com/ebs/" rel="noopener noreferrer" target="_blank">Amazon Elastic Block Store</a> (Amazon EBS) backed instance from an unencrypted AMI, you can directly specify the encryption properties in your existing workflow (such as with the <span style="font-family: courier">RunInstances</span> API or the Launch Instance Wizard). This simplifies the process of launching instances with encrypted volumes and reduces your associated AMI storage costs.</p> 
<p>In this post, we demonstrate how you can start from an unencrypted AMI and launch an encrypted EBS-backed Amazon EC2 instance. We’ll show you how to do this from both the AWS Management Console, and using the <span style="font-family: courier">RunInstances</span> API with the AWS Command Line Interface (AWS CLI).</p> 
<h2>Launching an instance from the AWS Management Console </h2> 
<ol> 
 <li>Sign into the <a href="https://console.aws.amazon.com/console/home" rel="noopener noreferrer" target="_blank">AWS Management Console</a> and open the <a href="https://console.aws.amazon.com/ec2/" rel="noopener noreferrer" target="_blank">EC2 console</a>.</li> 
 <li>Select <b>Launch instance</b>, then follow the prompts of the launch wizard: 
  <ol type="a"> 
   <li>In step 1 of the wizard, select the <a href="http://docs.aws.amazon.com/AWSEC2/latest/UserGuide/AMIs.html" rel="noopener noreferrer" target="_blank">Amazon Machine Image</a> (AMI) that you want to use.</li> 
   <li>In step 2 of the wizard, select your <a href="https://aws.amazon.com/ec2/instance-types/" rel="noopener noreferrer" target="_blank">instance type</a>.</li> 
   <li>In step 3, provide additional configuration details. For details about configuring your instances, see <a href="http://docs.aws.amazon.com/AWSEC2/latest/UserGuide/launching-instance.html" rel="noopener noreferrer" target="_blank">Launching an Instance</a>.</li> 
   <li>In step 4, specify your EBS volumes. The encryption properties of the volumes will be inherited from the AMI that you’ve chosen. If you’re using an unencrypted AMI, it will show up as “Not Encrypted.” From the dropdown, you can then select a <span style="font-family: courier"><a href="http://docs.aws.amazon.com/kms/latest/developerguide/concepts.html#master_keys" rel="noopener noreferrer" target="_blank">customer master key</a></span> (CMK) for encrypting the volume. You may select the same CMK for each volume that you want to create, or you may use a different CMK for each volume.<br /> &nbsp;<br /> 
    <div id="attachment_9959" style="width: 1629px" class="wp-caption aligncenter">
     <img src="https://d2908q01vomqb2.cloudfront.net/22d200f8670dbdb3e253a90eee5098477c95c23d/2019/02/06/Launching-encrypted-EBS-backed-instance-Figure1-original.png" alt="Figure 1: Specifying your EBS volumes" width="1619" height="514" class="size-full wp-image-9959" />
     <p class="wp-caption-text">Figure 1: Specifying your EBS volumes</p>
    </div> </li> 
  </ol> </li> 
 <li>Select <b>Review</b> and then <b>Launch</b>. Your instance will launch with an encrypted Amazon EBS volume that uses the CMK you selected. To learn more about the launch wizard, see <a href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/launching-instance.html" rel="noopener noreferrer" target="_blank">Launching an Instance with Launch Wizard</a>.</li> 
</ol> 
<h2>Launching an instance from the RunInstances API </h2> 
<p>From the <span style="font-family: courier"><a href="https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_RunInstances.html" rel="noopener noreferrer" target="_blank">RunInstances</a></span> API/CLI, you can provide the kmsKeyID for encrypting the volumes that will be created from the AMI by specifying encryption in the <span style="font-family: courier"><a href="https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_BlockDeviceMapping.html" rel="noopener noreferrer" target="_blank">BlockDeviceMapping</a></span> (BDM) object. If you don’t specify the <span style="font-family: courier">kmsKeyID</span> in BDM but set the encryption flag to “true,” then AWS Managed CMK will be used for encrypting the volume. </p> 
<p>For example, to launch an encrypted instance from an Amazon Linux AMI with an additional empty 100 GB of data volume (<span style="font-family: courier">/dev/sdb</span>), the API call would be as follows:</p> 
<div class="hide-language"> 
 <pre><code class="lang-text">
    $&gt; aws ec2 run-instances 
    --image-id ami-009d6802948d06e52
    --count 1 
    --instance-ype m4.large 
    --region us-east-1
    --subnet-id subnet-aec2fc86 
    --key-name 2016KeyPair 
    --security-group-ids sg-f7dbc78e subnet-id subnet-aec2fc86 
    --block-device-mappings <a href="\\mapping.json" rel="noopener noreferrer" target="_blank">file://mapping.json</a>    
</code></pre> 
</div> 
<p> Where the <span style="font-family: courier">mapping.json</span> contains the following:</p> 
<div class="hide-language"> 
 <pre><code class="lang-text">
[
    {
        &quot;DeviceName&quot;: &quot;/dev/xvda&quot;,
        &quot;Ebs&quot;: {
                &quot;Encrypted&quot;: true,
                &quot;KmsKeyId&quot;: &quot;arn:aws:kms:<font color="red">&lt;us-east-1:012345678910&gt;</font>:key/<font color="red">&lt;Example_Key_ID_12345&gt;</font>&quot;
        }
    },

    {
        &quot;DeviceName&quot;: &quot;/dev/sdb&quot;,
        &quot;Ebs&quot;: {
            &quot;DeleteOnTermination&quot;: true,
            &quot;VolumeSize&quot;: 100,
            &quot;VolumeType&quot;: &quot;gp2&quot;,
            &quot;Encrypted&quot;: true,
            &quot;KmsKeyId&quot;: &quot;arn:aws:kms:<font color="red">&lt;us-east-1:012345678910&gt;</font>:key/<font color="red">&lt;Example_Key_ID_12345&gt;</font>&quot;
        }
    }
]
</code></pre> 
</div> 
<p>You may specify different keys for different volumes. Providing a <span style="font-family: courier">kmsKeyID</span> without the encryption flag will result in an API error. </p> 
<h2>Conclusion</h2> 
<p>In this blog post, we demonstrated how you can quickly launch encrypted, EBS-backed instances from an unencrypted AMI in a few steps. You can also use the same process to launch EBS-backed encrypted volumes from unencrypted snapshots. This simplifies the process of launching instances with encrypted volumes and reduces your AMI storage costs.</p> 
<p>This feature is available through the <a href="https://aws.amazon.com/console" rel="noopener noreferrer" target="_blank">AWS Management Console</a>, <a href="https://aws.amazon.com/cli/" rel="noopener noreferrer" target="_blank">AWS CLI</a>, or AWS SDKs at no extra charge in all commercial AWS regions except China. If you have feedback about this blog post, submit comments in the <b>Comments</b> section below. If you have questions about this blog post, start a new thread on the <a href="https://forums.aws.amazon.com/forum.jspa?forumID=30" rel="noopener noreferrer" target="_blank">Amazon EC2 forum</a> or contact <a href="https://console.aws.amazon.com/support/home" rel="noopener noreferrer" target="_blank">AWS Support</a>.</p> 
<p><strong>Want more AWS Security how-to content, news, and feature announcements? Follow us on <a href="https://twitter.com/AWSsecurityinfo" title="Twitter" target="_blank" rel="noopener noreferrer">Twitter</a>.</strong></p> 
<footer> 
 <div class="blog-author-box"> 
  <div class="blog-author-image"> 
   <img src="https://d2908q01vomqb2.cloudfront.net/22d200f8670dbdb3e253a90eee5098477c95c23d/2019/02/06/nishit-nagar-bio.jpg" alt="Author" width="119" height="160" class="aligncenter size-full wp-image-9956" /> 
  </div> 
  <h3 class="lb-h4">Nishit Nagar</h3> 
  <p>Nishit is a Senior Product Manager at AWS.</p> 
  <p></p>
 </div> 
</footer>