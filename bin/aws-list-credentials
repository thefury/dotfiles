#!/usr/bin/env ruby

# This cript runs through your aws credentials file and tests each of
# the named profiles. It will print out some simple information based on
# that.

def process(line)
  profile = /^\[(.*)\]/.match line

  if profile
    puts "==== #{profile[1]}"
    puts `aws sts get-caller-identity --profile #{profile[1]}`
    puts
  end
end


credentials = "#{ENV['HOME']}/.aws/credentials"


file = File.open(credentials)
file.each_line { |line| process(line) }
